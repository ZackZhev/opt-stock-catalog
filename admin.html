<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 50%, #b3c2e8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px 25px;
            background: rgba(255,255,255,0.9);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        h1 {
            color: #1a237e;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1::before {
            content: '';
            width: 8px;
            height: 35px;
            background: linear-gradient(180deg, #5c6bc0, #3949ab);
            border-radius: 4px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(57, 73, 171, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #444;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: #eee;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
            color: white;
            padding: 8px 14px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 57, 53, 0.4);
        }

        .btn-edit {
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            color: white;
            padding: 8px 14px;
            font-size: 0.85em;
        }

        .btn-edit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(92, 107, 192, 0.4);
        }

        .btn-export {
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
            color: white;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 160, 71, 0.4);
        }

        .btn-import {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            color: white;
        }

        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 136, 229, 0.4);
        }

        /* –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255,255,255,0.9);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #5c6bc0, #3949ab);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters-panel {
            background: rgba(255,255,255,0.9);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            background: #fff;
            color: #333;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-input:focus {
            outline: none;
            border-color: #5c6bc0;
            box-shadow: 0 0 15px rgba(92, 107, 192, 0.2);
        }

        .filter-select {
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 0.95em;
            background: #fff;
            color: #333;
            cursor: pointer;
            min-width: 180px;
        }

        .filter-select option {
            background: #fff;
            color: #333;
        }

        .filter-select:focus {
            outline: none;
            border-color: #5c6bc0;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            color: #1a237e;
            font-size: 1.4em;
        }

        .close-btn {
            background: #f5f5f5;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #ffebee;
            color: #e53935;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #fff;
            color: #333;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #999;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #5c6bc0;
            box-shadow: 0 0 15px rgba(92, 107, 192, 0.2);
        }

        .form-group select option {
            background: #fff;
            color: #333;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .price-input-group {
            display: flex;
            gap: 10px;
        }

        .price-input-group input {
            flex: 1;
        }

        .price-input-group select {
            width: 100px;
        }

        .converted-price {
            margin-top: 8px;
            padding: 10px 14px;
            background: #e8f5e9;
            border-radius: 8px;
            color: #2e7d32;
            font-size: 0.9em;
            border: 1px solid #c8e6c9;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        /* –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-admin {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .product-admin-item {
            background: rgba(255,255,255,0.95);
            border-radius: 14px;
            padding: 18px 22px;
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .product-admin-item:hover {
            transform: translateX(5px);
            background: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-color: #5c6bc0;
        }

        .product-admin-image {
            width: 65px;
            height: 65px;
            min-width: 65px;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .product-admin-image:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .product-admin-image:hover::after {
            content: '+';
            position: absolute;
            inset: 0;
            background: rgba(92, 107, 192, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            border-radius: 12px;
        }

        .product-admin-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-admin-info {
            flex: 1;
        }

        .product-admin-name {
            font-weight: 600;
            color: #1a237e;
            margin-bottom: 4px;
            font-size: 1.05em;
        }

        .product-admin-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-top: 6px;
        }

        .product-admin-price {
            color: #2e7d32;
            font-weight: 600;
            font-size: 1.1em;
        }

        .product-admin-barcode {
            color: #888;
            font-size: 0.85em;
            font-family: monospace;
        }

        .product-admin-category {
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .product-admin-stock {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .stock-high {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .stock-low {
            background: #fff8e1;
            color: #f57f17;
        }

        .stock-out {
            background: #ffebee;
            color: #c62828;
        }

        .product-admin-actions {
            display: flex;
            gap: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 20px;
            border: 2px dashed #ccc;
        }

        .empty-state p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 25px;
        }

        /* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ */
        .hidden-input {
            display: none;
        }

        /* –ü–∞–Ω–µ–ª—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Ü–µ–Ω */
        .price-range-panel {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 12px 18px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .price-range-label {
            color: #666;
            font-size: 0.9em;
        }

        .price-range-input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            color: #333;
            font-size: 0.9em;
        }

        .price-range-input:focus {
            outline: none;
            border-color: #5c6bc0;
        }

        .btn-small {
            padding: 8px 14px;
            font-size: 0.85em;
            background: #f5f5f5;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .btn-small:hover {
            background: #eee;
        }

        /* –ò–∫–æ–Ω–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .category-icon {
            width: 20px;
            text-align: center;
            margin-right: 4px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-admin-item {
            animation: fadeInUp 0.4s ease forwards;
        }

        .product-admin-item:nth-child(1) { animation-delay: 0.02s; }
        .product-admin-item:nth-child(2) { animation-delay: 0.04s; }
        .product-admin-item:nth-child(3) { animation-delay: 0.06s; }
        .product-admin-item:nth-child(4) { animation-delay: 0.08s; }
        .product-admin-item:nth-child(5) { animation-delay: 0.1s; }

        /* –°—á—ë—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-count {
            color: rgba(255,255,255,0.5);
            font-size: 0.9em;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .products-count span {
            color: #00d9ff;
            font-weight: 600;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stat-card {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #5c6bc0, #3949ab);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        /* –°—á—ë—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-count {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 8px;
        }

        .products-count span {
            color: #5c6bc0;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .header-buttons {
                width: 100%;
                justify-content: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .product-admin-item {
                flex-wrap: wrap;
            }

            .product-admin-actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: 10px;
            }

            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
    </style>
    <style id="login-styles">
        .login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 50%, #b3c2e8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-box {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h2 {
            color: #1a237e;
            font-size: 1.6em;
            margin-bottom: 8px;
        }

        .login-box p {
            color: #666;
            margin-bottom: 25px;
            font-size: 0.95em;
        }

        .login-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1em;
            text-align: center;
            letter-spacing: 3px;
            transition: all 0.3s ease;
            background: #fafafa;
            color: #333;
        }

        .login-input:focus {
            outline: none;
            border-color: #5c6bc0;
            box-shadow: 0 0 15px rgba(92,107,192,0.2);
            background: #fff;
        }

        .login-input.error {
            border-color: #e53935;
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            50% { transform: translateX(8px); }
            75% { transform: translateX(-4px); }
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            margin-top: 18px;
            background: linear-gradient(135deg, #5c6bc0, #3949ab);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(57,73,171,0.4);
        }

        .login-error {
            color: #e53935;
            font-size: 0.9em;
            margin-top: 12px;
            min-height: 20px;
        }

        .login-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-icon">üîí</div>
            <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</p>
            <input type="password" class="login-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autofocus
                onkeydown="if(event.key==='Enter')checkPassword()">
            <button class="login-btn" onclick="checkPassword()">–í–æ–π—Ç–∏</button>
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <div class="container" id="adminContent" style="display:none;">
        <header>
            <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <div class="exchange-rate-box" style="display:flex;align-items:center;gap:8px;background:#f5f5f5;padding:10px 15px;border-radius:10px;">
                <label style="color:#666;font-size:13px;font-weight:500;">–ö—É—Ä—Å: 1 USD =</label>
                <input type="number" id="exchangeRateInput" value="89" min="1" step="0.01"
                    style="width:70px;padding:6px 10px;border:2px solid #e0e0e0;border-radius:8px;background:#fff;color:#333;font-size:14px;text-align:center;font-weight:600;"
                    oninput="updateExchangeRate(this.value)">
                <span style="color:#666;font-size:13px;font-weight:500;">–°–û–ú</span>
            </div>
            <div class="header-buttons">
                <button class="btn btn-export" onclick="printCatalog()">–ü–µ—á–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="previewCatalog()">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                <button class="btn btn-import" onclick="downloadPDF()">–°–∫–∞—á–∞—Ç—å PDF</button>
                <button class="btn btn-danger" onclick="resetProducts()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <a href="index.html" class="btn btn-secondary">–ö–∞—Ç–∞–ª–æ–≥</a>
                <button class="btn btn-primary" onclick="openModal()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </header>

        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-value" id="totalProducts">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalCategories">0</div>
                <div class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="inStock">0</div>
                <div class="stat-label">–í –Ω–∞–ª–∏—á–∏–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="outOfStock">0</div>
                <div class="stat-label">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalStock">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –µ–¥–∏–Ω–∏—Ü</div>
            </div>
        </div>

        <div class="filters-panel">
            <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —à—Ç—Ä–∏—Ö–∫–æ–¥—É...">
            <select class="filter-select" id="categoryFilter">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            </select>
            <select class="filter-select" id="stockFilter">
                <option value="">–õ—é–±–æ–µ –Ω–∞–ª–∏—á–∏–µ</option>
                <option value="in">–í –Ω–∞–ª–∏—á–∏–∏</option>
                <option value="low">–ú–∞–ª–æ</option>
                <option value="out">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
            </select>
            <select class="filter-select" id="sortFilter">
                <option value="name-asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ê-–Ø</option>
                <option value="name-desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ø-–ê</option>
                <option value="price-asc">–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                <option value="price-desc">–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                <option value="stock-asc">–ù–∞–ª–∏—á–∏–µ: –º–∞–ª–æ ‚Üí –º–Ω–æ–≥–æ</option>
                <option value="stock-desc">–ù–∞–ª–∏—á–∏–µ: –º–Ω–æ–≥–æ ‚Üí –º–∞–ª–æ</option>
            </select>
        </div>

        <div class="price-range-panel">
            <div class="price-range-label">–¶–µ–Ω–∞ –æ—Ç</div>
            <input type="number" id="priceMin" class="price-range-input" placeholder="0" min="0" step="0.01">
            <div class="price-range-label">–¥–æ</div>
            <input type="number" id="priceMax" class="price-range-input" placeholder="999" min="0" step="0.01">
            <div class="price-range-label">USD</div>
            <button class="btn btn-small" onclick="clearPriceFilter()">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>

        <div class="products-admin" id="productsAdmin">
            <!-- –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ localStorage -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">

                <div class="form-group">
                    <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                    <input type="text" id="productName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>

                <div class="form-group">
                    <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="productCategory">
                        <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="skincare">–£—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π</option>
                        <option value="haircare">–£—Ö–æ–¥ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏</option>
                        <option value="makeup">–ú–∞–∫–∏—è–∂</option>
                        <option value="perfume">–ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è</option>
                        <option value="hygiene">–ì–∏–≥–∏–µ–Ω–∞</option>
                        <option value="supplements">–î–æ–±–∞–≤–∫–∏</option>
                        <option value="sets">–ù–∞–±–æ—Ä—ã</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="productDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="productPrice">–¶–µ–Ω–∞ *</label>
                        <div class="price-input-group">
                            <input type="number" id="productPrice" required step="0.01" min="0" placeholder="0.00" oninput="updateConvertedPrice()">
                            <select id="priceCurrency" onchange="updateConvertedPrice()">
                                <option value="USD">USD</option>
                                <option value="SOM">–°–û–ú</option>
                            </select>
                        </div>
                        <div class="converted-price" id="convertedPrice" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label for="productStock">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                        <input type="number" id="productStock" required min="0" value="0" placeholder="0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="productBarcode">–®—Ç—Ä–∏—Ö–∫–æ–¥</label>
                    <input type="text" id="productBarcode" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 4601234567890">
                </div>

                <div class="form-group">
                    <label for="productImage">–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                    <input type="url" id="productImage" placeholder="https://example.com/image.jpg">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script src="products-data.js"></script>
    <script>
        // === –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ===
        const ADMIN_PASSWORD = 'admin2025';

        function checkPassword() {
            const input = document.getElementById('loginPassword');
            const error = document.getElementById('loginError');

            if (input.value === ADMIN_PASSWORD) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                sessionStorage.setItem('adminAuth', 'true');
            } else {
                input.classList.add('error');
                error.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                setTimeout(() => {
                    input.classList.remove('error');
                }, 400);
                input.value = '';
                input.focus();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ (–Ω–µ –ø—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤ —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ)
        if (sessionStorage.getItem('adminAuth') === 'true') {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
        }

        // === –û–°–ù–û–í–ù–û–ô –ö–û–î ===
        let editingId = null;
        let EXCHANGE_RATE = parseFloat(localStorage.getItem('exchangeRate')) || 89; // 1 USD = X –°–û–ú

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏
        const CATEGORIES = {
            skincare: '–£—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π',
            haircare: '–£—Ö–æ–¥ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏',
            makeup: '–ú–∞–∫–∏—è–∂',
            perfume: '–ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è',
            hygiene: '–ì–∏–≥–∏–µ–Ω–∞',
            supplements: '–î–æ–±–∞–≤–∫–∏',
            sets: '–ù–∞–±–æ—Ä—ã',
            other: '–î—Ä—É–≥–æ–µ'
        };

        const CATEGORY_ICONS = {
            skincare: '‚ú®',
            haircare: 'üíá',
            makeup: 'üíÑ',
            perfume: 'üå∏',
            hygiene: 'üß¥',
            supplements: 'üíä',
            sets: 'üéÅ',
            other: 'üì¶'
        };

        // INITIAL_PRODUCTS is loaded from products-data.js
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ localStorage –ø—É—Å—Ç–æ–π)
        function initializeProducts() {
            const existing = localStorage.getItem('products');
            if (!existing || existing === '[]') {
                localStorage.setItem('products', JSON.stringify(INITIAL_PRODUCTS));
            }
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π localStorage
        function seedNewProducts() {
            const existing = JSON.parse(localStorage.getItem('products') || '[]');
            const existingNames = new Set(existing.map(p => p.name.toLowerCase()));
            let changed = false;

            INITIAL_PRODUCTS.forEach(ip => {
                if (!existingNames.has(ip.name.toLowerCase())) {
                    existing.push(ip);
                    existingNames.add(ip.name.toLowerCase());
                    changed = true;
                } else if (parseFloat(ip.price) > 0) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –µ—Å–ª–∏ –±—ã–ª–∞ 0 –∞ —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å
                    const match = existing.find(p => p.name.toLowerCase() === ip.name.toLowerCase());
                    if (match && parseFloat(match.price) === 0) {
                        match.price = ip.price;
                        match.currency = ip.currency || 'USD';
                        match.stock = ip.stock || match.stock;
                        changed = true;
                    }
                }
            });

            if (changed) {
                localStorage.setItem('products', JSON.stringify(existing));
            }
        }

        // –°–±—Ä–æ—Å –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        function resetProducts() {
            const confirmPhrase = '–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å';
            const userInput = prompt('–î–ª—è —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤–≤–µ–¥–∏—Ç–µ —Ñ—Ä–∞–∑—É:\n\n"' + confirmPhrase + '"');

            if (userInput === null) return; // –û—Ç–º–µ–Ω–∞

            if (userInput.trim().toLowerCase() === confirmPhrase.toLowerCase()) {
                localStorage.setItem('products', JSON.stringify(INITIAL_PRODUCTS));
                loadProducts();
                updateStats();
                alert('–ó–∞–≥—Ä—É–∂–µ–Ω–æ 335 —Ç–æ–≤–∞—Ä–æ–≤!');
            } else {
                alert('–§—Ä–∞–∑–∞ –≤–≤–µ–¥–µ–Ω–∞ –Ω–µ–≤–µ—Ä–Ω–æ. –°–±—Ä–æ—Å –æ—Ç–º–µ–Ω—ë–Ω.');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç
        function updateExchangeRate(value) {
            const rate = parseFloat(value);
            if (rate && rate > 0) {
                EXCHANGE_RATE = rate;
                localStorage.setItem('exchangeRate', rate);
                loadProducts();
                updateStats();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—É—Ä—Å–∞ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        function initExchangeRate() {
            const input = document.getElementById('exchangeRateInput');
            if (input) input.value = EXCHANGE_RATE;
        }

        // –í—ã–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        initializeProducts();
        seedNewProducts();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ localStorage)
        function applyPriceUpdates() {
            const updates = [
                {id: "302", price: "7.03", stock: 99},
                {id: "303", price: "7.03", stock: 99},
                {id: "305", price: "9.72", stock: 99},
                {id: "306", price: "7.72", stock: 99},
                {id: "307", price: "6.25", stock: 99},
                {id: "308", price: "6.80", stock: 99},
                {id: "309", price: "7.05", stock: 99},
                {id: "310", price: "8.24", stock: 99},
                {id: "313", price: "6.59", stock: 99},
                {id: "315", price: "6.59", stock: 99},
                {id: "316", price: "6.59", stock: 99},
                {id: "317", price: "10.00", stock: 99},
                {id: "318", price: "0.11", stock: 99},
                {id: "319", price: "6.59", stock: 99},
                {id: "320", price: "6.59", stock: 99},
                {id: "321", price: "8.05", stock: 99},
                {id: "322", price: "8.05", stock: 99},
                {id: "323", price: "2.55", stock: 99},
                {id: "324", price: "17.45", stock: 99},
                {id: "325", price: "8.15", stock: 99},
                {id: "326", price: "10.00", stock: 99},
                {id: "327", price: "13.03", stock: 99},
                {id: "328", price: "17.11", stock: 99},
                {id: "329", price: "18.61", stock: 99},
                {id: "330", price: "18.61", stock: 99},
                {id: "331", price: "18.61", stock: 99},
            ];

            const products = JSON.parse(localStorage.getItem('products') || '[]');
            let changed = false;

            updates.forEach(upd => {
                const product = products.find(p => p.id === upd.id);
                if (product) {
                    product.price = upd.price;
                    product.stock = upd.stock;
                    changed = true;
                }
            });

            if (changed) {
                localStorage.setItem('products', JSON.stringify(products));
            }
        }
        applyPriceUpdates();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');

            document.getElementById('totalProducts').textContent = products.length;

            const categories = new Set(products.map(p => p.category).filter(c => c));
            document.getElementById('totalCategories').textContent = categories.size;

            const inStock = products.filter(p => (p.stock || 0) > 0).length;
            document.getElementById('inStock').textContent = inStock;

            const outOfStock = products.filter(p => (p.stock || 0) === 0).length;
            document.getElementById('outOfStock').textContent = outOfStock;

            // –í—Å–µ–≥–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞
            const totalStock = products.reduce((sum, p) => sum + (p.stock || 0), 0);
            document.getElementById('totalStock').textContent = totalStock.toLocaleString('ru-RU');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function updateCategoryFilter() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const select = document.getElementById('categoryFilter');
            const currentValue = select.value;

            const categories = new Set(products.map(p => p.category).filter(c => c));

            select.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = CATEGORIES[cat] || cat;
                select.appendChild(option);
            });

            select.value = currentValue;
        }

        // –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
        function getFilteredProducts() {
            let products = JSON.parse(localStorage.getItem('products') || '[]');

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
            const searchQuery = document.getElementById('searchInput').value.toLowerCase().trim();
            if (searchQuery) {
                products = products.filter(p =>
                    p.name.toLowerCase().includes(searchQuery) ||
                    (p.description && p.description.toLowerCase().includes(searchQuery)) ||
                    (p.barcode && p.barcode.toLowerCase().includes(searchQuery))
                );
            }

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const categoryFilter = document.getElementById('categoryFilter').value;
            if (categoryFilter) {
                products = products.filter(p => p.category === categoryFilter);
            }

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–ª–∏—á–∏—é
            const stockFilter = document.getElementById('stockFilter').value;
            if (stockFilter === 'in') {
                products = products.filter(p => (p.stock || 0) > 5);
            } else if (stockFilter === 'low') {
                products = products.filter(p => (p.stock || 0) > 0 && (p.stock || 0) <= 5);
            } else if (stockFilter === 'out') {
                products = products.filter(p => (p.stock || 0) === 0);
            }

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É —Ü–µ–Ω
            const priceMin = parseFloat(document.getElementById('priceMin').value) || 0;
            const priceMax = parseFloat(document.getElementById('priceMax').value) || Infinity;
            if (priceMin > 0 || priceMax < Infinity) {
                products = products.filter(p => {
                    const price = parseFloat(p.price) || 0;
                    return price >= priceMin && price <= priceMax;
                });
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            const sortFilter = document.getElementById('sortFilter').value;
            switch (sortFilter) {
                case 'name-asc':
                    products.sort((a, b) => a.name.localeCompare(b.name, 'ru'));
                    break;
                case 'name-desc':
                    products.sort((a, b) => b.name.localeCompare(a.name, 'ru'));
                    break;
                case 'price-asc':
                    products.sort((a, b) => getPriceInUSD(a) - getPriceInUSD(b));
                    break;
                case 'price-desc':
                    products.sort((a, b) => getPriceInUSD(b) - getPriceInUSD(a));
                    break;
                case 'stock-asc':
                    products.sort((a, b) => (a.stock || 0) - (b.stock || 0));
                    break;
                case 'stock-desc':
                    products.sort((a, b) => (b.stock || 0) - (a.stock || 0));
                    break;
            }

            return products;
        }

        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–∞ —Ü–µ–Ω
        function clearPriceFilter() {
            document.getElementById('priceMin').value = '';
            document.getElementById('priceMax').value = '';
            loadProducts();
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Å —Å—Ç–∞—Ç—É—Å–∞ —Å–∫–ª–∞–¥–∞
        function getStockClass(stock) {
            if (stock > 5) return 'stock-high';
            if (stock > 0) return 'stock-low';
            return 'stock-out';
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ —Å–∫–ª–∞–¥–∞
        function getStockText(stock) {
            if (stock > 5) return `${stock} —à—Ç.`;
            if (stock > 0) return `–ú–∞–ª–æ: ${stock} —à—Ç.`;
            return '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏';
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É –≤ USD –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        function getPriceInUSD(product) {
            const price = parseFloat(product.price) || 0;
            return product.currency === 'SOM' ? price / EXCHANGE_RATE : price;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ü–µ–Ω—É
        function updateConvertedPrice() {
            const price = parseFloat(document.getElementById('productPrice').value) || 0;
            const currency = document.getElementById('priceCurrency').value;
            const convertedEl = document.getElementById('convertedPrice');

            if (price > 0) {
                if (currency === 'SOM') {
                    const usdPrice = (price / EXCHANGE_RATE).toFixed(2);
                    convertedEl.textContent = `= $${usdPrice} USD`;
                } else {
                    const somPrice = (price * EXCHANGE_RATE).toLocaleString('ru-RU');
                    convertedEl.textContent = `= ${somPrice} –°–û–ú`;
                }
                convertedEl.style.display = 'block';
            } else {
                convertedEl.style.display = 'none';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        function loadProducts() {
            const products = getFilteredProducts();
            const allProducts = JSON.parse(localStorage.getItem('products') || '[]');
            const container = document.getElementById('productsAdmin');

            if (products.length === 0) {
                const searchQuery = document.getElementById('searchInput').value.trim();
                container.innerHTML = `
                    <div class="empty-state">
                        <p>${searchQuery ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–¢–æ–≤–∞—Ä—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã'}</p>
                        ${!searchQuery ? '<button class="btn btn-primary" onclick="openModal()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä</button>' : ''}
                    </div>
                `;
                return;
            }

            const countText = products.length === allProducts.length
                ? `–ü–æ–∫–∞–∑–∞–Ω–æ: <span>${products.length}</span> —Ç–æ–≤–∞—Ä–æ–≤`
                : `–ü–æ–∫–∞–∑–∞–Ω–æ: <span>${products.length}</span> –∏–∑ <span>${allProducts.length}</span> —Ç–æ–≤–∞—Ä–æ–≤`;

            container.innerHTML = `
                <div class="products-count">${countText}</div>
            ` + products.map(product => {
                const icon = CATEGORY_ICONS[product.category] || 'üì¶';
                const categoryName = CATEGORIES[product.category] || product.category || '';
                return `
                <div class="product-admin-item">
                    <div class="product-admin-image" onclick="editProduct('${product.id}')" title="–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ">
                        ${product.image ? `<img src="${product.image}" alt="${product.name}">` : icon}
                    </div>
                    <div class="product-admin-info">
                        <div class="product-admin-name">${product.name}</div>
                        <div class="product-admin-meta">
                            <span class="product-admin-price">${product.currency === 'SOM'
                                ? `${Math.round(parseFloat(product.price || 0)).toLocaleString('ru-RU')} —Å–æ–º <span style="color:#666;font-weight:400;font-size:0.85em">/ $${(parseFloat(product.price || 0) / EXCHANGE_RATE).toFixed(2)}</span>`
                                : `$${parseFloat(product.price || 0).toFixed(2)} <span style="color:#666;font-weight:400;font-size:0.85em">/ ${Math.round(parseFloat(product.price || 0) * EXCHANGE_RATE).toLocaleString('ru-RU')} —Å–æ–º</span>`
                            }</span>
                            ${product.category ? `<span class="product-admin-category"><span class="category-icon">${icon}</span>${categoryName}</span>` : ''}
                            <span class="product-admin-stock ${getStockClass(product.stock || 0)}">${getStockText(product.stock || 0)}</span>
                            ${product.barcode ? `<span class="product-admin-barcode">${product.barcode}</span>` : ''}
                        </div>
                    </div>
                    <div class="product-admin-actions">
                        <button class="btn btn-edit" onclick="editProduct('${product.id}')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `}).join('');
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function openModal() {
            editingId = null;
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
            document.getElementById('productForm').reset();
            document.getElementById('priceCurrency').value = 'USD';
            document.getElementById('productStock').value = '0';
            document.getElementById('convertedPrice').style.display = 'none';
            document.getElementById('productModal').classList.add('active');
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            document.getElementById('productModal').classList.remove('active');
            editingId = null;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
        function saveProduct(e) {
            e.preventDefault();

            const products = JSON.parse(localStorage.getItem('products') || '[]');

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–Ω—É –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç–µ
            let price = parseFloat(document.getElementById('productPrice').value) || 0;
            const currency = document.getElementById('priceCurrency').value;

            const productData = {
                id: editingId || Date.now().toString(),
                name: document.getElementById('productName').value.trim(),
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value.trim(),
                price: price.toFixed(2),
                currency: currency,
                stock: parseInt(document.getElementById('productStock').value) || 0,
                barcode: document.getElementById('productBarcode').value.trim(),
                image: document.getElementById('productImage').value.trim()
            };

            if (editingId) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const index = products.findIndex(p => p.id === editingId);
                if (index !== -1) {
                    products[index] = productData;
                }
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ
                products.push(productData);
            }

            localStorage.setItem('products', JSON.stringify(products));
            closeModal();
            loadProducts();
            updateStats();
            updateCategoryFilter();
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
        function editProduct(id) {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id === id);

            if (!product) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productPrice').value = product.price || '0';
            document.getElementById('priceCurrency').value = product.currency || 'USD';
            document.getElementById('productStock').value = product.stock || '0';
            document.getElementById('productBarcode').value = product.barcode || '';
            document.getElementById('productImage').value = product.image || '';
            updateConvertedPrice();
            document.getElementById('productModal').classList.add('active');
        }

        // –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
        function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) return;

            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const filtered = products.filter(p => p.id !== id);
            localStorage.setItem('products', JSON.stringify(filtered));
            loadProducts();
            updateStats();
            updateCategoryFilter();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞
        function generateCatalogHTML(autoPrint = false) {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            products.sort((a, b) => a.name.localeCompare(b.name, 'ru'));
            const today = new Date().toLocaleDateString('ru-RU');

            let rows = '';
            products.forEach((product, index) => {
                const rawPrice = parseFloat(product.price || 0);
                const priceUSD = product.currency === 'SOM' ? (rawPrice / EXCHANGE_RATE).toFixed(2) : rawPrice.toFixed(2);
                const priceSOM = product.currency === 'SOM' ? Math.round(rawPrice).toLocaleString('ru-RU') : Math.round(rawPrice * EXCHANGE_RATE).toLocaleString('ru-RU');
                const category = CATEGORIES[product.category] || product.category || '‚Äî';
                const stock = product.stock || 0;
                let stockClass = 'stock-out';
                let stockText = '–ù–µ—Ç';
                if (stock > 5) { stockClass = 'stock-in'; stockText = stock + ' —à—Ç.'; }
                else if (stock > 0) { stockClass = 'stock-low'; stockText = stock + ' —à—Ç.'; }

                rows += '<tr>' +
                    '<td>' + (index + 1) + '</td>' +
                    '<td><b>' + product.name + '</b>' +
                    (product.barcode && !product.barcode.startsWith('http') ? '<br><small style="color:#888;font-family:monospace">' + product.barcode + '</small>' : '') +
                    '</td>' +
                    '<td style="color:#666">' + category + '</td>' +
                    '<td class="' + stockClass + '">' + stockText + '</td>' +
                    '<td class="price" style="color:#2563eb;font-weight:bold">$' + priceUSD + '</td>' +
                    '<td class="price" style="color:#059669">' + priceSOM + '</td>' +
                    '</tr>';
            });

            return '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</title>' +
                '<style>' +
                '*{margin:0;padding:0;box-sizing:border-box}' +
                'body{font-family:Arial,sans-serif;padding:20px;font-size:11px;background:#fff}' +
                '.header{text-align:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #333}' +
                '.header h1{font-size:24px;margin-bottom:8px;color:#1a1a2e}' +
                '.header p{color:#666;font-size:12px}' +
                'table{width:100%;border-collapse:collapse}' +
                'th{background:#f0f0f0;padding:8px 5px;text-align:left;border-bottom:2px solid #333;font-size:10px}' +
                'td{padding:6px 5px;border-bottom:1px solid #ddd;vertical-align:top}' +
                'tr:nth-child(even){background:#fafafa}' +
                '.price{text-align:right;white-space:nowrap}' +
                '.stock-in{color:#059669}' +
                '.stock-low{color:#d97706}' +
                '.stock-out{color:#dc2626}' +
                '.footer{margin-top:20px;text-align:center;color:#999;font-size:10px}' +
                '@media print{body{padding:10px}.no-print{display:none}}' +
                '</style></head><body>' +
                '<div class="header"><h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>' +
                '<p>–î–∞—Ç–∞: ' + today + ' | –ö—É—Ä—Å: 1 USD = ' + EXCHANGE_RATE + ' –°–û–ú | –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ' + products.length + '</p></div>' +
                '<table><thead><tr>' +
                '<th style="width:30px">‚Ññ</th>' +
                '<th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>' +
                '<th style="width:100px">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>' +
                '<th style="width:70px">–ù–∞–ª–∏—á–∏–µ</th>' +
                '<th style="width:70px" class="price">USD</th>' +
                '<th style="width:80px" class="price">–°–û–ú</th>' +
                '</tr></thead><tbody>' + rows + '</tbody></table>' +
                '<div class="footer">–û–ø—Ç–æ–≤—ã–π –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</div>' +
                (autoPrint ? '<script>window.onload=function(){window.print()}<\/script>' : '') +
                '</body></html>';
        }

        // –ü–µ—á–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥–∞
        function printCatalog() {
            const html = generateCatalogHTML(true);
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞
        function previewCatalog() {
            const html = generateCatalogHTML(false);
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(html);
            previewWindow.document.close();
        }

        // –°–∫–∞—á–∞—Ç—å PDF
        async function downloadPDF() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            if (products.length === 0) {
                alert('–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }

            // –°–æ–∑–¥–∞—ë–º —Å–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            const container = document.createElement('div');
            container.style.cssText = 'position:fixed;left:0;top:0;width:800px;background:#fff;z-index:99999;padding:20px;';
            container.innerHTML = generateCatalogHTML(false).replace(/<html>|<\/html>|<head>.*?<\/head>|<body>|<\/body>|<!DOCTYPE html>/gs, '');
            document.body.appendChild(container);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:99998;';
            overlay.innerHTML = '<div style="color:#fff;font-size:20px;">–°–æ–∑–¥–∞–Ω–∏–µ PDF...</div>';
            document.body.appendChild(overlay);

            try {
                // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º html2canvas
                if (!window.html2canvas) {
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                }

                // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º jsPDF
                if (!window.jspdf) {
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                }

                // –ñ–¥—ë–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                await new Promise(r => setTimeout(r, 300));

                // –°–æ–∑–¥–∞—ë–º canvas
                const canvas = await html2canvas(container, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                // –°–æ–∑–¥–∞—ë–º PDF
                const { jsPDF } = window.jspdf;
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                const pdf = new jsPDF('p', 'mm', 'a4');
                let heightLeft = imgHeight;
                let position = 0;

                const imgData = canvas.toDataURL('image/jpeg', 0.95);

                // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // –°–∫–∞—á–∏–≤–∞–µ–º
                const today = new Date().toISOString().split('T')[0];
                pdf.save('catalog_' + today + '.pdf');

            } catch (error) {
                console.error('PDF Error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è PDF: ' + error.message + '\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é "–ü–µ—á–∞—Ç—å" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ PDF"');
            } finally {
                container.remove();
                overlay.remove();
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ—ë
        document.getElementById('productModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // –°–æ–±—ã—Ç–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.getElementById('searchInput').addEventListener('input', loadProducts);
        document.getElementById('categoryFilter').addEventListener('change', loadProducts);
        document.getElementById('stockFilter').addEventListener('change', loadProducts);
        document.getElementById('sortFilter').addEventListener('change', loadProducts);
        document.getElementById('priceMin').addEventListener('input', loadProducts);
        document.getElementById('priceMax').addEventListener('input', loadProducts);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadProducts();
        updateStats();
        updateCategoryFilter();
        initExchangeRate();
    </script>
</body>
</html>
